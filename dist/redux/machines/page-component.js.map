{"version":3,"sources":["../../../src/redux/machines/page-component.js"],"names":["Machine","actions","assign","require","module","exports","id","initial","context","isInBootstrap","componentPath","query","on","BOOTSTRAP_FINISHED","DELETE_PAGE","NEW_PAGE_CREATED","PAGE_CONTEXT_MODIFIED","QUERY_EXTRACTION_GRAPHQL_ERROR","QUERY_EXTRACTION_BABEL_ERROR","states","inactive","target","cond","inactiveWhileBootstrapping","QUERY_CHANGED","queryExtractionGraphQLError","QUERY_DID_NOT_CHANGE","queryExtractionBabelError","QUERY_EXTRACTION_BABEL_SUCCESS","runningPageQueries","onEntry","QUERIES_COMPLETE","idle","guards","isBootstrapping","isNotBootstrapping","runPageComponentQueries","event","queryUtil","setTimeout","enqueueExtractedPageComponent","setQuery","ctx","setPage","pages","path","enqueueExtractedQueryId","runQueuedQueries","push","deletePage","filter","p","page","setBootstrapFinished"],"mappings":"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","sourcesContent":["const {\n  Machine,\n  actions: { assign },\n} = require(`xstate`)\n\nmodule.exports = Machine(\n  {\n    id: `pageComponents`,\n    initial: `inactive`,\n    context: {\n      isInBootstrap: true,\n      componentPath: ``,\n      query: ``,\n    },\n    on: {\n      BOOTSTRAP_FINISHED: {\n        actions: `setBootstrapFinished`,\n      },\n      DELETE_PAGE: {\n        actions: `deletePage`,\n      },\n      NEW_PAGE_CREATED: {\n        actions: `setPage`,\n      },\n      PAGE_CONTEXT_MODIFIED: {\n        actions: `runPageComponentQueries`,\n      },\n      QUERY_EXTRACTION_GRAPHQL_ERROR: `queryExtractionGraphQLError`,\n      QUERY_EXTRACTION_BABEL_ERROR: `queryExtractionBabelError`,\n    },\n    states: {\n      inactive: {\n        on: {\n          // Transient transition\n          // Will transition to either 'inactiveWhileBootstrapping' or idle\n          // immediately upon entering 'inactive' state if the condition is met.\n          \"\": [\n            { target: `inactiveWhileBootstrapping`, cond: `isBootstrapping` },\n            { target: `idle`, cond: `isNotBootstrapping` },\n          ],\n        },\n      },\n      inactiveWhileBootstrapping: {\n        on: {\n          BOOTSTRAP_FINISHED: {\n            target: `idle`,\n            actions: `setBootstrapFinished`,\n          },\n          QUERY_CHANGED: `runningPageQueries`,\n        },\n      },\n      queryExtractionGraphQLError: {\n        on: {\n          QUERY_DID_NOT_CHANGE: `idle`,\n          QUERY_CHANGED: `runningPageQueries`,\n        },\n      },\n      queryExtractionBabelError: {\n        on: {\n          QUERY_EXTRACTION_BABEL_SUCCESS: `idle`,\n        },\n      },\n      runningPageQueries: {\n        onEntry: [`setQuery`, `runPageComponentQueries`],\n        on: {\n          QUERIES_COMPLETE: `idle`,\n        },\n      },\n      idle: {\n        on: {\n          QUERY_CHANGED: `runningPageQueries`,\n        },\n      },\n    },\n  },\n  {\n    guards: {\n      isBootstrapping: context => context.isInBootstrap,\n      isNotBootstrapping: context => !context.isInBootstrap,\n    },\n    actions: {\n      runPageComponentQueries: (context, event) => {\n        const queryUtil = require(`../../query`)\n        // Wait a bit as calling this function immediately triggers\n        // an Action call which Redux squawks about.\n        setTimeout(() => {\n          queryUtil.enqueueExtractedPageComponent(context.componentPath)\n        }, 0)\n      },\n      setQuery: assign({\n        query: (ctx, event) => {\n          if (typeof event.query !== `undefined` || event.query !== null) {\n            return event.query\n          } else {\n            return ctx.query\n          }\n        },\n      }),\n      setPage: assign({\n        pages: (ctx, event) => {\n          if (event.path) {\n            const queryUtil = require(`../../query`)\n            // Wait a bit as calling this function immediately triggers\n            // an Action call which Redux squawks about.\n            setTimeout(() => {\n              if (!ctx.isInBootstrap) {\n                queryUtil.enqueueExtractedQueryId(event.path)\n                queryUtil.runQueuedQueries(event.path)\n              }\n            }, 0)\n            ctx.pages.push(event.path)\n            return ctx.pages\n          } else {\n            return ctx.pages\n          }\n        },\n      }),\n      deletePage: assign({\n        pages: (ctx, event) => ctx.pages.filter(p => p !== event.page.path),\n      }),\n      setBootstrapFinished: assign({\n        isInBootstrap: false,\n      }),\n    },\n  }\n)\n"],"file":"page-component.js"}